<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>
        
            Facade类分析
                 
    </title>
    <meta name="generator" content="Jekyll" />
    <meta name="author" content="jacho" />
    <meta name="description" content="Laravel框架的Facade类分析。" />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="/css/violet.css" type="text/css" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="http://feeds.feedburner.com/jachohx" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link href="/css/pygments.css" rel="stylesheet">
    <link href="/css/base.css" rel="stylesheet">
    <script type="text/javascript" src="/js/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="/js/toc.js"></script>
    <script type="text/javascript" src="/js/smooth-scroller.js"></script>
    <script type="text/javascript" src="/js/affix.js"></script>
    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', "UA-35504774-1"]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>
<body class="post-content">
	<header class="inner"><h1 class="left"><a href="/">DreamCoder</a></h1>
	<div class="right">
		<form class="search right" action="http://google.com/search" method="get">
			<input class="left" type="text" name="q" results="0">
			<input type="hidden" name="q" value="site:">
		</form>
		<div class="social right">
			<a class="facebook" href="http://facebook.com/jachohx" title="Facebook">Facebook</a>
			<a class="google" href="https://plus.google.com" title="Google+">Google+</a>
			<a class="twitter" href="http://" title="Twitter">Twitter</a>
			<a class="github" href="https://" title="GitHub">GitHub</a>
			<a class="rss" href="http://http://feeds.feedburner.com/jachohx" title="RSS">RSS</a>
		</div>
	</div>

	</header>
        <section class="content fn-clear" id="i-am-top">
	   <!-- <div id="toc" data-spy="affix" data-offset-top="140"></div> -->
        <div class="content-cnt">
	        <div class="ui-grid-25 ui-grid-right content-top">
	            <section class="ui-grid-23 violet-post">
	                <div class="v-section-tit">
	                    <a href="/" rel="nofollow" >首页</a>
	                    <span>&#9830;</span>
	                    <h2>Facade类分析</h2>
	                </div>
	                <div class="violet-post-det fn-clear">
	                    <div class="ui-grid-15 v-post-detail">
	                        <div class="v-entry">
	                            <h1 class="title">Facade类分析</h1>
	                            <p class="meta"><time class="date" pubdate="2016-02-01">2016-02-01</time> By <a href="/contact.html" class="author" title="author">jacho</a>
								<label>分类</label>
								
									<a href="#/category/tech">技术</a>
								
								<label>标签</label>
								</p>
	                            <p class="description">Laravel框架的Facade类分析。</p>
	                            <p>Facade类在文档中的介绍是这样说的</p>

<blockquote>
<p>Facades 提供一个静态接口给在应用程序的 <a href="http://laravel-china.org/docs/5.0/container">服务容器</a> 中可以取用的类。Laravel 附带许多 facades，甚至你可能已经在不知情的状况下使用过它们！Laravel 的「facades」作为在 IoC 容器里面的基础类的静态代理，提供的语法有简洁、易表达的优点，同时维持比传统的静态方法更高的可测试性和弹性。</p>
</blockquote>

<p>说明可以查看<a href="http://laravel-china.org/docs/5.0/facades">官方文档地址</a>。</p>

<p>但在官方文档里只说Facade是怎么使用，并没有说明这个类是运行情况。</p>

<!--more-->

<p>下边就介绍下Facade的工作过程：</p>

<h2>新的Facade类</h2>

<p>在官方文档里已经有介绍了，下边以DB类为例子。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
    <span class="k">namespace</span> <span class="nx">Illuminate\Support\Facades</span><span class="p">;</span>
    <span class="sd">/**</span>
<span class="sd">     * @see \Illuminate\Database\DatabaseManager</span>
<span class="sd">     *@see \Illuminate\Database\Connection</span>
<span class="sd">     */</span>
    <span class="k">class</span> <span class="nc">DB</span> <span class="k">extends</span> <span class="nx">Facade</span>
    <span class="p">{</span>
        <span class="sd">/**</span>
<span class="sd">         *Get the registered name of the component.</span>
<span class="sd">         *</span>
<span class="sd">         *@return string</span>
<span class="sd">         */</span>
      <span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getFacadeAccessor</span><span class="p">()</span>
      <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;db&#39;</span><span class="p">;</span>
      <span class="p">}</span>

    <span class="p">}</span>
</code></pre></div>
<p>这里实现了Facade的getFacadeAccessor方法，这个方法的工作是返回服务容器绑定的名称。</p>

<p>那么有一个疑问就是，DB类是怎么通过&#39;db&#39;取出来的。</p>

<h2>静态方法加载</h2>

<p>像DB类，我们这样使用DB::select(…)，面DB类里根本就没有select这个静态方法。</p>

<p>根据PHP这个语言特色，DB::select最终会调用Facade类的__callStatic方法</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the root object behind the facade.</span>
<span class="sd">     *</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getFacadeRoot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">static</span><span class="o">::</span><span class="na">resolveFacadeInstance</span><span class="p">(</span><span class="k">static</span><span class="o">::</span><span class="na">getFacadeAccessor</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Resolve the facade root instance from the container.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  string|object  $name</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">resolveFacadeInstance</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_object</span><span class="p">(</span><span class="nv">$name</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$name</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="k">static</span><span class="o">::</span><span class="nv">$resolvedInstance</span><span class="p">[</span><span class="nv">$name</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">static</span><span class="o">::</span><span class="nv">$resolvedInstance</span><span class="p">[</span><span class="nv">$name</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">static</span><span class="o">::</span><span class="nv">$resolvedInstance</span><span class="p">[</span><span class="nv">$name</span><span class="p">]</span> <span class="o">=</span> <span class="k">static</span><span class="o">::</span><span class="nv">$app</span><span class="p">[</span><span class="nv">$name</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle dynamic, static calls to the object.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  string  $method</span>
<span class="sd">     * @param  array   $args</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">__callStatic</span><span class="p">(</span><span class="nv">$method</span><span class="p">,</span> <span class="nv">$args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$instance</span> <span class="o">=</span> <span class="k">static</span><span class="o">::</span><span class="na">getFacadeRoot</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$instance</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">RuntimeException</span><span class="p">(</span><span class="s1">&#39;A facade root has not been set.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">switch</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$args</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
                <span class="k">return</span> <span class="nv">$instance</span><span class="o">-&gt;</span><span class="nv">$method</span><span class="p">();</span>

            <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
                <span class="k">return</span> <span class="nv">$instance</span><span class="o">-&gt;</span><span class="nv">$method</span><span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

            <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
                <span class="k">return</span> <span class="nv">$instance</span><span class="o">-&gt;</span><span class="nv">$method</span><span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

            <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
                <span class="k">return</span> <span class="nv">$instance</span><span class="o">-&gt;</span><span class="nv">$method</span><span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

            <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
                <span class="k">return</span> <span class="nv">$instance</span><span class="o">-&gt;</span><span class="nv">$method</span><span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>

            <span class="k">default</span><span class="o">:</span>
                <span class="k">return</span> <span class="nb">call_user_func_array</span><span class="p">([</span><span class="nv">$instance</span><span class="p">,</span> <span class="nv">$method</span><span class="p">],</span> <span class="nv">$args</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
<p>从这个方法就可以知道，最开始的时候会先调用getFacadeRoot方法知道，返回的容易最终于还是通过static::$app[$name];返回</p>

<h2>Facade的$app参数</h2>

<p>在Facade并没有加载$app参数的过程，只有一个set的方法</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
    <span class="sd">/**</span>
<span class="sd">     * Set the application instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Contracts\Foundation\Application  $app</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">setFacadeApplication</span><span class="p">(</span><span class="nv">$app</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">static</span><span class="o">::</span><span class="nv">$app</span> <span class="o">=</span> <span class="nv">$app</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div>
<p>这个setFacadeApplication方法是在类 Illuminate\Foundation\Bootstrap\RegisterFacades方法 bootstrap(Application $app)设置</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Illuminate\Foundation\Bootstrap</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Facade</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\AliasLoader</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Foundation\Application</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RegisterFacades</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Bootstrap the given application.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Contracts\Foundation\Application  $app</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">bootstrap</span><span class="p">(</span><span class="nx">Application</span> <span class="nv">$app</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">Facade</span><span class="o">::</span><span class="na">clearResolvedInstances</span><span class="p">();</span>

        <span class="nx">Facade</span><span class="o">::</span><span class="na">setFacadeApplication</span><span class="p">(</span><span class="nv">$app</span><span class="p">);</span>

        <span class="nx">AliasLoader</span><span class="o">::</span><span class="na">getInstance</span><span class="p">(</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">make</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;app.aliases&#39;</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>页RegisterFacades类载见配置vendor/composer/autoload_classmap.php</p>

<h2>$app的db加载</h2>

<p>到了这里，$app设置完了，那么，$app里的db参数是什么时候设置的呢？</p>

<p>$app参数是Illuminate\Foundation\Application类，类有一个构造函数</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span> 
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$basePath</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registerBaseBindings</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registerBaseServiceProviders</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registerCoreContainerAliases</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$basePath</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setBasePath</span><span class="p">(</span><span class="nv">$basePath</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">registerCoreContainerAliases</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$aliases</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;app&#39;</span>                  <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Foundation\Application&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Container\Container&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Foundation\Application&#39;</span><span class="p">],</span>
            <span class="s1">&#39;auth&#39;</span>                 <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Auth\AuthManager&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Auth\Factory&#39;</span><span class="p">],</span>
            <span class="s1">&#39;auth.driver&#39;</span>          <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Contracts\Auth\Guard&#39;</span><span class="p">],</span>
            <span class="s1">&#39;auth.password&#39;</span>        <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Contracts\Auth\PasswordBrokerFactory&#39;</span><span class="p">],</span>
            <span class="s1">&#39;auth.password.broker&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Contracts\Auth\PasswordBroker&#39;</span><span class="p">],</span>
            <span class="s1">&#39;blade.compiler&#39;</span>       <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\View\Compilers\BladeCompiler&#39;</span><span class="p">],</span>
            <span class="s1">&#39;cache&#39;</span>                <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Cache\CacheManager&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Cache\Factory&#39;</span><span class="p">],</span>
            <span class="s1">&#39;cache.store&#39;</span>          <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Cache\Repository&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Cache\Repository&#39;</span><span class="p">],</span>
            <span class="s1">&#39;config&#39;</span>               <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Config\Repository&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Config\Repository&#39;</span><span class="p">],</span>
            <span class="s1">&#39;cookie&#39;</span>               <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Cookie\CookieJar&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Cookie\Factory&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Cookie\QueueingFactory&#39;</span><span class="p">],</span>
            <span class="s1">&#39;encrypter&#39;</span>            <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Encryption\Encrypter&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Encryption\Encrypter&#39;</span><span class="p">],</span>
            <span class="s1">&#39;db&#39;</span>                   <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Database\DatabaseManager&#39;</span><span class="p">],</span>
            <span class="s1">&#39;db.connection&#39;</span>        <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Database\Connection&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Database\ConnectionInterface&#39;</span><span class="p">],</span>
            <span class="s1">&#39;events&#39;</span>               <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Events\Dispatcher&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Events\Dispatcher&#39;</span><span class="p">],</span>
            <span class="s1">&#39;files&#39;</span>                <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Filesystem\Filesystem&#39;</span><span class="p">],</span>
            <span class="s1">&#39;filesystem&#39;</span>           <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Filesystem\FilesystemManager&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Filesystem\Factory&#39;</span><span class="p">],</span>
            <span class="s1">&#39;filesystem.disk&#39;</span>      <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Contracts\Filesystem\Filesystem&#39;</span><span class="p">],</span>
            <span class="s1">&#39;filesystem.cloud&#39;</span>     <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Contracts\Filesystem\Cloud&#39;</span><span class="p">],</span>
            <span class="s1">&#39;hash&#39;</span>                 <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Contracts\Hashing\Hasher&#39;</span><span class="p">],</span>
            <span class="s1">&#39;translator&#39;</span>           <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Translation\Translator&#39;</span><span class="p">,</span> <span class="s1">&#39;Symfony\Component\Translation\TranslatorInterface&#39;</span><span class="p">],</span>
            <span class="s1">&#39;log&#39;</span>                  <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Log\Writer&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Logging\Log&#39;</span><span class="p">,</span> <span class="s1">&#39;Psr\Log\LoggerInterface&#39;</span><span class="p">],</span>
            <span class="s1">&#39;mailer&#39;</span>               <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Mail\Mailer&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Mail\Mailer&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Mail\MailQueue&#39;</span><span class="p">],</span>
            <span class="s1">&#39;auth.password&#39;</span>        <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Auth\Passwords\PasswordBrokerManager&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Auth\PasswordBrokerFactory&#39;</span><span class="p">],</span>
            <span class="s1">&#39;auth.password.broker&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Auth\Passwords\PasswordBroker&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Auth\PasswordBroker&#39;</span><span class="p">],</span>
            <span class="s1">&#39;queue&#39;</span>                <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Queue\QueueManager&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Queue\Factory&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Queue\Monitor&#39;</span><span class="p">],</span>
            <span class="s1">&#39;queue.connection&#39;</span>     <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Contracts\Queue\Queue&#39;</span><span class="p">],</span>
            <span class="s1">&#39;redirect&#39;</span>             <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Routing\Redirector&#39;</span><span class="p">],</span>
            <span class="s1">&#39;redis&#39;</span>                <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Redis\Database&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Redis\Database&#39;</span><span class="p">],</span>
            <span class="s1">&#39;request&#39;</span>              <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Http\Request&#39;</span><span class="p">,</span> <span class="s1">&#39;Symfony\Component\HttpFoundation\Request&#39;</span><span class="p">],</span>
            <span class="s1">&#39;router&#39;</span>               <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Routing\Router&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Routing\Registrar&#39;</span><span class="p">],</span>
            <span class="s1">&#39;session&#39;</span>              <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Session\SessionManager&#39;</span><span class="p">],</span>
            <span class="s1">&#39;session.store&#39;</span>        <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Session\Store&#39;</span><span class="p">,</span> <span class="s1">&#39;Symfony\Component\HttpFoundation\Session\SessionInterface&#39;</span><span class="p">],</span>
            <span class="s1">&#39;url&#39;</span>                  <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Routing\UrlGenerator&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Routing\UrlGenerator&#39;</span><span class="p">],</span>
            <span class="s1">&#39;validator&#39;</span>            <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\Validation\Factory&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\Validation\Factory&#39;</span><span class="p">],</span>
            <span class="s1">&#39;view&#39;</span>                 <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Illuminate\View\Factory&#39;</span><span class="p">,</span> <span class="s1">&#39;Illuminate\Contracts\View\Factory&#39;</span><span class="p">],</span>
        <span class="p">];</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$aliases</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$aliases</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$aliases</span> <span class="k">as</span> <span class="nv">$alias</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">alias</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$alias</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
<p>构造函数会调用registerCoreContainerAliases方法，这个方法里的aliases数组就有db，对应的类就是Illuminate\Database\DatabaseManager，那就也就是DB::select会调用Illuminate\Database\DatabaseManager::select</p>

<ul>
<li>​</li>
</ul>

	                        </div>
	                        <nav class="v-pagination">
	                            
	                            <a class="prev" href="/post/syntax.html" rel="bookmark">&laquo;&nbsp;Markdown语法说明</a>
	                            
	                            
	                         </nav>
	                         <div class="violet-comment">
	                             <div id="disqus_thread"><div id="disqus_thread"></div>
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname = 'jachohx'; // required: replace example with your forum shortname
	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
	                         </div><!-- //violet-comment -->
	                    </div>                   
	                </div>
	            </section><!-- //violet-post -->
	        </div>
	        <!-- <div id="toc" data-spy="affix" data-offset-top="140"></div> -->
	        <div id="toc" data-spy="affix" data-offset-top="140"></div>
        </div>
        <script type="text/javascript">
            $(document).ready(function() {
                $('#toc').toc({
                    'selectors': 'h2,h3', //elements to use as headings
                    'container': '.violet-post-det', //element to find all selectors in
                    'smoothScrolling': false, //enable or disable smooth scrolling on click
                    'prefix': 'toc', //prefix for anchor tags and class names
                    'onHighlight': function(el) {}, //called when a new section is highlighted 
                    'highlightOnScroll': true, //add class to heading that is currently in focus
                    'highlightOffset': 0, //offset to trigger the next headline
                    'anchorName': function(i, heading, prefix) { //custom function for anchor name
                        return prefix+i;
                    },
                    'headerText': function(i, heading, $heading) { //custom function building the header-item text
                        return $heading.text();
                    },
                    'itemClass': function(i, heading, $heading, prefix) { // custom function for item class
                      return $heading[0].tagName.toLowerCase();
                    }
                });
            });
        </script>
    </section><!-- //content -->

</body>
</html>
